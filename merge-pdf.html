<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge PDF Files - PDF Toolkit</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .drop-zone {
            border: 2px dashed #ccc;
            padding: 2rem;
            text-align: center;
            margin: 1rem 0;
            cursor: pointer;
        }

        .preview-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .preview-item {
            border: 1px solid #ddd;
            padding: 0.5rem;
            text-align: center;
        }

        .preview-thumbnail {
            max-width: 100%;
            height: 150px;
            object-fit: contain;
            background: #f5f5f5;
        }

        #fileInput {
            display: none;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Merge PDF Files</h1>
    
    <div class="drop-zone" onclick="document.getElementById('fileInput').click()">
        <p>Drag & Drop PDF files here or Click to select</p>
        <p>(Select multiple PDF files)</p>
    </div>
    
    <input type="file" id="fileInput" accept=".pdf" multiple>
    
    <div class="preview-section" id="previewContainer"></div>
    
    <button onclick="mergePDFs()">Merge PDFs</button>
    <div id="status"></div>

    <script>
        let pdfFiles = [];

        // Handle file selection
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            pdfFiles = Array.from(e.target.files);
            showPreview();
        });

        // Drag & drop handlers
        const dropZone = document.querySelector('.drop-zone');
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#007bff';
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = '#ccc';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#ccc';
            pdfFiles = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
            showPreview();
        });

        // Show file preview
        async function showPreview() {
            const previewContainer = document.getElementById('previewContainer');
            previewContainer.innerHTML = '';
            
            for(const file of pdfFiles) {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                const reader = new FileReader();
                reader.onload = async (e) => {
                    const pdfData = new Uint8Array(e.target.result);
                    const pdfDoc = await PDFLib.PDFDocument.load(pdfData);
                    
                    previewItem.innerHTML = `
                        <div>
                            <p>${file.name}</p>
                            <p>Pages: ${pdfDoc.getPageCount()}</p>
                        </div>
                    `;
                };
                
                reader.readAsArrayBuffer(file);
                previewContainer.appendChild(previewItem);
            }
        }

        // Main merge function
        async function mergePDFs() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = 'Starting merge...';
            
            if(pdfFiles.length < 2) {
                statusDiv.innerHTML = 'Please select at least 2 PDF files';
                return;
            }

            try {
                const mergedPdf = await PDFLib.PDFDocument.create();
                
                for(const file of pdfFiles) {
                    statusDiv.innerHTML = `Processing ${file.name}...`;
                    const reader = new FileReader();
                    
                    const pdfBytes = await new Promise((resolve, reject) => {
                        reader.onload = () => resolve(new Uint8Array(reader.result));
                        reader.onerror = reject;
                        reader.readAsArrayBuffer(file);
                    });

                    const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);
                    const pages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                    pages.forEach(page => mergedPdf.addPage(page));
                }

                statusDiv.innerHTML = 'Finalizing merged PDF...';
                const mergedPdfBytes = await mergedPdf.save();
                
                // Save merged PDF
                const blob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
                saveAs(blob, 'merged-document.pdf');
                
                statusDiv.innerHTML = 'Merge completed successfully!';
                
            } catch (error) {
                statusDiv.innerHTML = `Error: ${error.message}`;
                console.error(error);
            }
        }
    </script>
</body>
</html>